package gui;

import db.DBConnection;
import models.User;

import javax.swing.*;
import java.awt.*;
import java.sql.*;

public class LoginFrame extends JFrame {
    public LoginFrame() {
        setTitle("üîê Login - CarQuest");
        setSize(400, 250);
        setDefaultCloseOperation(EXIT_ON_CLOSE);
        setLocationRelativeTo(null);
        setLayout(new GridLayout(4, 2, 10, 10));
        setResizable(false);

        JTextField emailField = new JTextField();
        JPasswordField passField = new JPasswordField();
        JButton loginBtn = new JButton("Login");

        emailField.setFont(new Font("Arial", Font.PLAIN, 16));
        passField.setFont(new Font("Arial", Font.PLAIN, 16));
        loginBtn.setFont(new Font("Arial", Font.BOLD, 16));

        add(new JLabel("Email:", SwingConstants.RIGHT)); add(emailField);
        add(new JLabel("Password:", SwingConstants.RIGHT)); add(passField);
        add(new JLabel("")); add(loginBtn);

        loginBtn.addActionListener(e -> {
            try (Connection conn = DBConnection.getConnection()) {
                PreparedStatement ps = conn.prepareStatement("SELECT * FROM users WHERE email=? AND password=?");
                ps.setString(1, emailField.getText());
                ps.setString(2, new String(passField.getPassword()));
                ResultSet rs = ps.executeQuery();

                if (rs.next()) {
                    User user = new User(
                            rs.getInt("id"),
                            rs.getString("name"),
                            rs.getString("email"),
                            rs.getString("password")
                    );

                    JOptionPane.showMessageDialog(this, "Login Successful! ‚úÖ");
                    dispose();
                    if (user.getEmail().equalsIgnoreCase("admin@urban.com")) {
                        new AdminDashboardFrame(user);
                    } else {
                        new DashboardFrame(user);
                    }
                } else {
                    JOptionPane.showMessageDialog(this, "‚ùå Invalid email or password.");
                }
            } catch (Exception ex) {
                ex.printStackTrace();
            }
        });

        setVisible(true);
    }
}
